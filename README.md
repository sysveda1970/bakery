# パン屋の原価計算アプリケーション

パン屋や製菓店向けの原価計算・レシピ管理Webアプリケーションです。材料費の管理、原価率の計算、商品ラベルの作成が簡単に行えます。

## 主要機能

### 1. ユーザー認証システム
- 店舗ごとの独立したアカウント管理
- セキュアなパスワード暗号化(bcrypt)
- セッション管理による認証

### 2. レシピ管理機能
- レシピの登録・編集・削除
- 商品名、材料、製造個数、販売価格の管理
- 材料ごとの使用量と単価の記録

### 3. 材料マスタ管理
- 材料の一元管理
- 材料名、単価、単位の登録
- レシピからの参照機能

### 4. 原価計算機能
- 材料費の自動計算
- 固定費配賦機能(ON/OFF切り替え可能)
  - 月額固定費の設定
  - 月間生産個数の設定
  - 商品1個あたりの固定費配賦額の自動計算
- 原価率・利益額・利益率の表示

### 5. 商品ラベル作成機能
- 商品ラベルのPDF出力
- 原材料表示
- 販売価格・製造日のオプション表示

## 技術スタック

- **バックエンド**: Python 3.8+, Flask 3.0
- **データベース**: SQLite
- **フロントエンド**: HTML5, CSS3, JavaScript, Bootstrap 5.3
- **認証**: Flask Session + bcrypt
- **PDF生成**: ReportLab

## インストール手順

### 1. 必要要件

- Python 3.8以上
- pip(パッケージ管理ツール)

### 2. セットアップ

#### Windows

```cmd
# プロジェクトディレクトリに移動
cd bakery-cost-calculator

# 仮想環境の作成
python -m venv venv

# 仮想環境の有効化
venv\Scripts\activate

# 必要なパッケージのインストール
pip install -r requirements.txt
```

#### macOS/Linux

```bash
# プロジェクトディレクトリに移動
cd bakery-cost-calculator

# 仮想環境の作成
python3 -m venv venv

# 仮想環境の有効化
source venv/bin/activate

# 必要なパッケージのインストール
pip install -r requirements.txt
```

### 3. アプリケーションの起動

```bash
# Flaskアプリケーションの起動
python app.py
```

起動後、ブラウザで以下のURLにアクセスしてください:
```
http://localhost:5000
```

## 使い方

### 初回利用時

1. **新規登録**
   - トップページで「新規登録はこちら」をクリック
   - 店舗名、ユーザーID、パスワードを入力して登録

2. **材料マスタの登録**
   - ログイン後、「材料マスタ」メニューから材料を追加
   - 材料名、単価(1単位あたり)、単位(g, ml, 個など)を入力

3. **レシピの作成**
   - 「レシピ管理」→「新規レシピ作成」
   - 商品名、販売価格、製造個数を入力
   - 使用する材料と使用量を追加

### 固定費設定(オプション)

固定費を原価に含める場合:

1. 「店舗設定」メニューを開く
2. 「固定費を原価計算に含める」にチェック
3. 月額固定費(家賃、光熱費、人件費など)を入力
4. 月間生産個数の合計を入力
5. 設定を保存

これにより、各商品の原価に固定費配賦額が自動で加算されます。

### ラベルの作成

1. 「レシピ管理」から該当レシピの「ラベル」ボタンをクリック
2. 表示項目(価格、製造日)を選択
3. 「PDFをダウンロード」をクリック
4. ダウンロードしたPDFを印刷

## データベース構造

### テーブル一覧

- **users**: ユーザー(店舗)情報
- **store_settings**: 店舗設定(固定費など)
- **ingredients**: 材料マスタ
- **recipes**: レシピ情報
- **recipe_ingredients**: レシピと材料の関連(中間テーブル)

## セキュリティ機能

- パスワードのbcryptハッシュ化
- SQLインジェクション対策(SQLAlchemyのORM使用)
- XSS対策(Jinjaテンプレートのエスケープ)
- CSRF対策(セッション管理)
- セッションタイムアウト(1時間)

## 開発環境

### デバッグモードでの起動

```python
# app.py の最終行がデバッグモード設定
if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=5000)
```

本番環境では `debug=False` に設定してください。

### 環境変数

本番環境では以下の環境変数を設定することを推奨します:

```bash
export SECRET_KEY='your-secret-key-here'
```

## トラブルシューティング

### データベースのリセット

データベースをリセットする場合:

```bash
# database.db ファイルを削除
rm database.db  # macOS/Linux
del database.db  # Windows

# アプリケーションを再起動すると新しいデータベースが作成されます
python app.py
```

### ポートが使用中のエラー

ポート5000が使用中の場合、app.pyの最終行のポート番号を変更してください:

```python
app.run(debug=True, host='0.0.0.0', port=5001)  # 5001に変更
```

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## サポート

問題や質問がある場合は、プロジェクトのIssueトラッカーまでご連絡ください。

## 今後の機能拡張案

- [ ] レシピのエクスポート/インポート機能
- [ ] 複数ラベルの一括出力
- [ ] 月次レポート機能
- [ ] 材料在庫管理
- [ ] 売上予測機能
- [ ] データのバックアップ/リストア機能

---

**開発者**: Claude Code
**バージョン**: 1.0.0
**最終更新**: 2024年
